import{r as o,u as m,c as x,j as e}from"./index-7qAbDpOm.js";function k(){const[s,i]=o.useState("checking"),[d,g]=o.useState("de"),c=m(),[l]=x();o.useEffect(()=>{const t=localStorage.getItem("siteLang");if(t&&["en","de"].includes(t))g(t);else{const n=navigator.language.startsWith("de")?"de":"en";g(n),localStorage.setItem("siteLang",n)}},[]),o.useEffect(()=>{localStorage.setItem("siteLang",d)},[d]);const r=t=>({de:{title:"Zahlung erfolgreich!",message:"Vielen Dank für Ihre Bestellung! Eine Zahlung von POWDUR wird auf Ihrem Konto erscheinen.",orderSent:"Ihre Bestellung wurde erfolgreich versendet.",backHome:"Zurück zur Startseite",checking:"Zahlung wird überprüft und Ihre Bestellung wird gespeichert …",failed:"Bezahlung fehlgeschlagen",failedMessage:"Die Zahlung wurde nicht erfolgreich abgeschlossen.",error:"Fehler aufgetreten",errorMessage:"Ein Fehler ist beim Verarbeiten Ihrer Bestellung aufgetreten.",tryAgain:"Zurück zur Startseite"},en:{title:"Payment Successful!",message:"Thank you for your purchase! A payment from POWDUR will appear on your statement.",orderSent:"Your order has been successfully sent.",backHome:"Back to Home",checking:"Verifying payment and saving your order...",failed:"Payment failed",failedMessage:"The payment was not completed successfully.",error:"An error occurred",errorMessage:"An error occurred while processing your order.",tryAgain:"Back to Home"}})[d][t]||t;return o.useEffect(()=>{(async()=>{const n=l.get("session_id"),p=l.get("order_id");if(!n){i("error");return}try{const a=await fetch(`/api/checkout-session?session_id=${n}`),u=await a.json();if(!a.ok||u.payment_status!=="paid"){i("failed");return}const f=localStorage.getItem("pendingOrder");if(!f)throw new Error("Temporäre Anfrage nicht gefunden");const h=JSON.parse(f);if(!h)throw new Error("Temporäre Anfrage nicht gefunden");if(!(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...h,id:u.metadata.order_id||p,status:"paid",payment:{method:"card",status:"paid",session_id:n}})})).ok)throw new Error("Anfrage konnte nicht in der Datenbank gespeichert werden");localStorage.removeItem("pendingOrder"),localStorage.removeItem("pendingOrderId"),i("success")}catch(a){console.error("Fehler beim Verarbeiten der Anfrage:",a),i("error")}})()},[l]),s==="checking"?e.jsxs("div",{style:{textAlign:"center",padding:"50px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h3",{children:r("checking")}),e.jsx("div",{style:{fontSize:"2rem",marginTop:"10px"},children:"⏳"})]}):s==="success"?e.jsx("div",{style:{textAlign:"center",padding:"60px 20px",backgroundColor:"#f8f9fa",minHeight:"100vh",fontFamily:"Arial, sans-serif",direction:"ltr"},children:e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",backgroundColor:"white",borderRadius:"16px",padding:"40px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)",border:"1px solid #e9ecef"},children:[e.jsx("div",{style:{fontSize:"4rem",color:"#4CAF50",marginBottom:"20px"},children:"🎉"}),e.jsx("h1",{style:{color:"#2c3e50",marginBottom:"16px",fontSize:"2rem"},children:r("title")}),e.jsx("p",{style:{color:"#555",lineHeight:"1.7",marginBottom:"16px",fontSize:"1.1rem"},children:r("message")}),e.jsx("p",{style:{color:"#155724",backgroundColor:"#d4edda",padding:"12px",borderRadius:"8px",border:"1px solid #c3e6cb",marginBottom:"24px",fontSize:"1.05rem"},children:r("orderSent")}),e.jsx("button",{onClick:()=>c("/"),style:{padding:"12px 30px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"1.1rem",boxShadow:"0 4px 12px rgba(9, 99, 50, 0.3)"},children:r("backHome")})]})}):s==="failed"?e.jsxs("div",{style:{textAlign:"center",padding:"60px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff5f5",minHeight:"100vh"},children:[e.jsx("h2",{style:{color:"#c00"},children:r("failed")}),e.jsx("p",{style:{color:"#555",marginBottom:"20px"},children:r("failedMessage")}),e.jsx("button",{onClick:()=>c("/"),style:{padding:"10px 20px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:r("tryAgain")})]}):s==="error"?e.jsxs("div",{style:{textAlign:"center",padding:"60px",fontFamily:"Arial, sans-serif",backgroundColor:"#fef6f6",minHeight:"100vh"},children:[e.jsx("h2",{style:{color:"#c00"},children:r("error")}),e.jsx("p",{style:{color:"#555",marginBottom:"20px"},children:r("errorMessage")}),e.jsx("button",{onClick:()=>c("/"),style:{padding:"10px 20px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:r("tryAgain")})]}):null}export{k as default};
