import{r as a,u as y,c as b,j as e}from"./index-UBRbdjYg.js";function k(){const[i,s]=a.useState("checking"),[l,u]=a.useState("de"),g=y(),[f]=b();a.useEffect(()=>{const t=localStorage.getItem("siteLang");if(t&&["en","de"].includes(t))u(t);else{const o=navigator.language.startsWith("de")?"de":"en";u(o),localStorage.setItem("siteLang",o)}},[]),a.useEffect(()=>{localStorage.setItem("siteLang",l)},[l]);const r=t=>({de:{title:"Zahlung erfolgreich!",message:"Vielen Dank für Ihre Bestellung! Eine Zahlung von POWDUR wird auf Ihrem Konto erscheinen.",orderSent:"Ihre Bestellung wurde erfolgreich versendet.",backHome:"Zurück zur Startseite",checking:"Zahlung wird überprüft und Ihre Bestellung wird gespeichert …",failed:"Bezahlung fehlgeschlagen",failedMessage:"Die Zahlung wurde nicht erfolgreich abgeschlossen.",error:"Fehler aufgetreten",errorMessage:"Ein Fehler ist beim Verarbeiten Ihrer Bestellung aufgetreten.",tryAgain:"Zurück zur Startseite"},en:{title:"Payment Successful!",message:"Thank you for your purchase! A payment from POWDUR will appear on your statement.",orderSent:"Your order has been successfully sent.",backHome:"Back to Home",checking:"Verifying payment and saving your order...",failed:"Payment failed",failedMessage:"The payment was not completed successfully.",error:"An error occurred",errorMessage:"An error occurred while processing your order.",tryAgain:"Back to Home"}})[l][t]||t;return a.useEffect(()=>{(async()=>{const o=f.get("session_id"),d=f.get("order_id");if(!o){s("error");return}try{const c=await fetch(`/api/checkout-session?session_id=${o}`),n=await c.json();if(!c.ok||n.payment_status!=="paid"){s("failed");return}const h=JSON.parse(localStorage.getItem("pendingOrder")),m=JSON.parse(localStorage.getItem("liefersoftOrder"));if(!h)throw new Error("Temporäre Anfrage nicht gefunden");if(!m)throw new Error("Liefersoft-Daten nicht gefunden");const x=await fetch("/api/forward-to-liefersoft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...m,id:n.metadata.order_id||d,paymentMethod:{paymentMethod:"card"}})});if(!x.ok){const p=await x.json().catch(()=>({}));throw console.error("Liefersoft API Fehler:",p),new Error("Anfrage konnte nicht an Liefersoft gesendet werden")}if(!(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...h,id:n.metadata.order_id||d,status:"paid",payment:{method:"card",status:"paid",session_id:o}})})).ok)throw new Error("Anfrage konnte nicht in der Datenbank gespeichert werden");try{await fetch("/api/send-order-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:{...h,id:n.metadata.order_id||d,status:"paid",payment:{method:"card",status:"paid"}},orderId:n.metadata.order_id||d})})}catch(p){console.warn("E-Mail konnte nicht gesendet werden:",p)}localStorage.removeItem("pendingOrder"),localStorage.removeItem("liefersoftOrder"),localStorage.removeItem("pendingOrderId"),s("success")}catch(c){console.error("Fehler beim Verarbeiten der Anfrage:",c),s("error")}})()},[f]),i==="checking"?e.jsxs("div",{style:{textAlign:"center",padding:"50px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h3",{children:r("checking")}),e.jsx("div",{style:{fontSize:"2rem",marginTop:"10px"},children:"⏳"})]}):i==="success"?e.jsx("div",{style:{textAlign:"center",padding:"60px 20px",backgroundColor:"#f8f9fa",minHeight:"100vh",fontFamily:"Arial, sans-serif",direction:"ltr"},children:e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",backgroundColor:"white",borderRadius:"16px",padding:"40px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)",border:"1px solid #e9ecef"},children:[e.jsx("div",{style:{fontSize:"4rem",color:"#4CAF50",marginBottom:"20px"},children:"🎉"}),e.jsx("h1",{style:{color:"#2c3e50",marginBottom:"16px",fontSize:"2rem"},children:r("title")}),e.jsx("p",{style:{color:"#555",lineHeight:"1.7",marginBottom:"16px",fontSize:"1.1rem"},children:r("message")}),e.jsx("p",{style:{color:"#155724",backgroundColor:"#d4edda",padding:"12px",borderRadius:"8px",border:"1px solid #c3e6cb",marginBottom:"24px",fontSize:"1.05rem"},children:r("orderSent")}),e.jsx("button",{onClick:()=>g("/"),style:{padding:"12px 30px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"1.1rem",boxShadow:"0 4px 12px rgba(9, 99, 50, 0.3)"},children:r("backHome")})]})}):i==="failed"?e.jsxs("div",{style:{textAlign:"center",padding:"60px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff5f5",minHeight:"100vh"},children:[e.jsx("h2",{style:{color:"#c00"},children:r("failed")}),e.jsx("p",{style:{color:"#555",marginBottom:"20px"},children:r("failedMessage")}),e.jsx("button",{onClick:()=>g("/"),style:{padding:"10px 20px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:r("tryAgain")})]}):i==="error"?e.jsxs("div",{style:{textAlign:"center",padding:"60px",fontFamily:"Arial, sans-serif",backgroundColor:"#fef6f6",minHeight:"100vh"},children:[e.jsx("h2",{style:{color:"#c00"},children:r("error")}),e.jsx("p",{style:{color:"#555",marginBottom:"20px"},children:r("errorMessage")}),e.jsx("button",{onClick:()=>g("/"),style:{padding:"10px 20px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:r("tryAgain")})]}):null}export{k as default};
