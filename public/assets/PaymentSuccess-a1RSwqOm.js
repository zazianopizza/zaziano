import{r as o,u as S,c as y,j as e}from"./index-a23O7UPs.js";function O(){const[g,n]=o.useState("checking"),[a,p]=o.useState("de"),m=S(),[s]=y();s.get("session_id"),o.useEffect(()=>{const r=localStorage.getItem("siteLang");r&&["en","de"].includes(r)?p(r):p(navigator.language.startsWith("de")?"de":"en")},[]),o.useEffect(()=>{localStorage.setItem("siteLang",a)},[a]);const i=r=>({de:{title:"Zahlung erfolgreich!",message:"Vielen Dank fÃ¼r Ihre Bestellung! Eine Zahlung von POWDUR wird auf Ihrem Konto erscheinen.",orderSent:"Ihre Bestellung wurde erfolgreich versendet.",backHome:"ZurÃ¼ck zur Startseite"},en:{title:"Payment Successful!",message:"Thank you for your purchase! A payment from POWDUR will appear on your statement.",orderSent:"Your order has been successfully sent.",backHome:"Back to Home"}})[a][r]||r;if(o.useEffect(()=>{(async()=>{const d=s.get("session_id"),c=s.get("order_id");if(!d){n("error");return}try{const t=await(await fetch(`/api/checkout-session?session_id=${d}`)).json();if(t.payment_status==="paid"){const l=JSON.parse(localStorage.getItem("pendingOrder")),u=JSON.parse(localStorage.getItem("liefersoftOrder"));if(!(await fetch("/api/forward-to-liefersoft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...u,id:t.metadata.order_id||c,paymentMethod:{paymentMethod:"card"}})})).ok)throw new Error("Anfrage konnte nicht gespeichert werden");if(!l)throw new Error("TemporÃ¤re Anfrage nicht gefunden");if(!(await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,id:t.metadata.order_id||c,status:"paid",payment:{method:"card",status:"paid",session_id:d}})})).ok)throw new Error("Anfrage konnte nicht gespeichert werden");const h=await fetch("/api/send-order-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:{...l,id:t.metadata.order_id||c,status:"paid",payment:{method:"card",status:"paid"}},orderId:t.metadata.order_id||c})});if(!h.ok){const x=await h.json();console.warn("E-Mail konnte nicht gesendet werden:",x)}localStorage.removeItem("pendingOrder"),localStorage.removeItem("pendingOrderId"),n("success")}else n("failed")}catch(f){console.error("Fehler beim Verarbeiten der Anfrage:",f),n("error")}})()},[s]),g==="checking")return e.jsx("div",{style:{textAlign:"center",padding:"50px"},children:e.jsx("h3",{children:"Zahlung wird Ã¼berprÃ¼ft und Ihre Bestellung wird gespeichert â€¦"})});if(g==="success")return e.jsx("div",{style:{textAlign:"center",padding:"60px 20px",backgroundColor:"#f8f9fa",minHeight:"100vh",direction:a==="de"?"ltr":"rtl"},children:e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",backgroundColor:"white",borderRadius:"16px",padding:"40px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)",border:"1px solid #e9ecef"},children:[e.jsx("div",{style:{fontSize:"4rem",color:"#4CAF50",marginBottom:"20px"},children:"ðŸŽ‰"}),e.jsx("h1",{style:{color:"#2c3e50",marginBottom:"16px",fontSize:"2rem"},children:i("title")}),e.jsx("p",{style:{color:"#555",lineHeight:"1.7",marginBottom:"16px",fontSize:"1.1rem"},children:i("message")}),e.jsx("p",{style:{color:"#155724",backgroundColor:"#d4edda",padding:"12px",borderRadius:"8px",border:"1px solid #c3e6cb",marginBottom:"24px",fontSize:"1.05rem"},children:i("orderSent")}),e.jsx("button",{onClick:()=>m("/"),style:{padding:"12px 30px",backgroundColor:"#096332ff",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"1.1rem",boxShadow:"0 4px 12px rgba(9, 99, 50, 0.3)"},children:i("backHome")})]})})}export{O as default};
